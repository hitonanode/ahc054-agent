# 戦略

以下の方針で実装する。

## 大目標

- 前処理として、最初のターンにだけ以下を行ってください。
  - 座標 (N - 1, j) であって、 (0, floor(N / 2)) から伝説の花から 5 以上離れた点のみを経由して到達可能で、 j が N / 2 に最も近いものを見つけてください。
  - (0, 0) から (0, floor(N / 2)), (N - 1, j) を順に経由し (N - 1, N - 1) まで行く最短路を求めてください。ただし、その最短路の (0, floor(N / 2)) から (N - 1, j) までの範囲では、伝説の花から距離 5 以上離れた点のみを使ってください。
  - その最短路上の、 (0, floor(N / 2)) から (N - 1, j) までの区間の各頂点について、そこの 4 方向に隣接しているマスで、最短路全体に属していないような全てのマスにトレントを配置してください。
- 各ターンで、以下の条件を満たすように適応的にトレントを配置する。
  - 冒険者が、次に移動することで伝説の花のマスに隣接してしまう可能性があり、更にトレントを配置することでこれが防止できるならば、かならずトレントを配置する。
  - もし何もしなければ、現在冒険者が現在存在するマスを含む 2x2 の小正方形に属する全てのマスが探索済の空きマスになってしまう状況で、冒険者に隣接する未探索のマス一つにトレントを埋めることでそれを回避でき、かつ制約違反が生じないならば、トレントを置く。ただし、そこに置いた結果冒険者が到達不能になる空きマスが生じる場合は置かない。これは 4 つの 2x2 小正方形全てに関して順に行う。
  - 次に、現在冒険者がいる地点から隣接するマスのうち、未探索の空きマスの個数が何個あるかによって、以下の場合分けを行う。
    - 3 個の場合。
      - 例えば上・下・右方向が未探索の場合、
        - 上、下方向は、2 マス先、3 マス先の 2 つの中で、隣接する 8 マスのうち冒険者に近い方の 3 マスのどこにも木がないマスがあればそこをトレントで埋める。それができなければ、2 マス先、3 マス先、... の中で、制約違反にならず、かつそこを置くことで、未探索のマスのうち、最も近い箇所をトレントで埋める。ただし、そこに置いた結果冒険者が到達不能になる空きマスが生じる場合は置かない。
        - 右方向はすぐ隣のマスをトレントで埋める。
      - それ以外のパターンの場合も同様に、向かい合う 2 方向については上記のアルゴリズムで選んで埋め、残りの一方向に関しては（制約違反でなければ）すぐ隣のマスを埋める。
    - 2 個の場合。
      - 各方向について、2 マス先、3 マス先の 2 つの中で、隣接する 8 マスのうち冒険者に近い方の 3 マスのどこにも木がないマスがあればそこをトレントで埋める。それができなければ、2 マス先、3 マス先、... の中で、制約違反にならない最も近い箇所をトレントで埋める。ただし、そこに置いた結果冒険者が到達不能になる空きマスが生じる場合は置かない。
    - 1 個のみの場合。
      - 各方向について、2 マス先に既に木があれば何もしない。それ以外の場合、2 マス先、3 マス先の 2 つの中で、隣接する 8 マスのうち冒険者に近い方の 3 マスのどこにも木がないマスがあればそこをトレントで埋める。それができなければ、3 マス先、4 マス先、... の中で、制約違反にならない最も近い箇所をトレントで埋める。ただし、そこに置いた結果冒険者が到達不能になる空きマスが生じる場合は置かない。
  - 各方向について、隣接するマスは確認済みだが、もっと遠くの方に「追加で何も置かない場合にその方向の確認済みマスで木ではないマス」が生じてしまう場合に、その方向に制約違反にならない範囲で 1 つトレントを配置する。
    - 各方向について、2 マス先、3 マス先、... の中で、制約違反にならない最も近い箇所をトレントで埋める。ただし、そこに置いた結果冒険者が到達不能になる空きマスが生じる場合は置かない。
  - 次に、そのターンに何もしなければ伝説の花のマスが確認済みマスになってしまう場合、（制約違反でなければ）必ずトレントを配置して防止する。これは、冒険者に近いマスから順に確認し、制約違反にならない最初のマスに置く。
  - 次に、そのターンに何もしなければ伝説の花に隣接するマスが確認済みマスになってしまう場合、（制約違反でなければ）必ずトレントを配置して防止する。これは、冒険者に近いマスから順に確認し、制約違反にならない最初のマスに置く。
- トレントは、上記の目標を満たすために最低限必要なものだけを配置する。
